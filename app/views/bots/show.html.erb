<div class="page-header">
  <h1 class="merci">Merci pour votre choix</h1>
  <p>Vous avez choisi : <span><%= @bot.name.capitalize %></span></p>
</div>

<div class="container">
  <div class="card">
    <div class="card-header">
      <h2>Réservez votre expérience IA</h2>
    </div>

    <%= form_with(model: Rental.new, url: rentals_path, local: true, id: 'rental-form', class: 'rental-form') do |form| %>
      <%= form.hidden_field :bot_id, value: @bot.id %>

      <div class="form-group">
        <%= form.label :start_date, "Date de début" %>
        <%= form.date_field :start_date, id: 'start_date', class: 'form-control' %>
      </div>

      <div class="form-group">
        <%= form.label :end_date, "Date de fin" %>
        <%= form.date_field :end_date, id: 'end_date', class: 'form-control' %>
      </div>

      <%= form.submit "Réserver ce Bot", class: "submit-button" %>
    <% end %>
  </div>

  <div class="price-card">
    <h2>Coût total</h2>
    <div class="total-price" id="total-price">
      <%= number_to_currency(0) %>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Ajouter un écouteur d'événement sur le changement de valeur des champs de date
    document.querySelectorAll(".form-control").forEach(function(input) {
      input.addEventListener("change", function() {
        // Appeler la fonction pour mettre à jour le total_price
        updateTotalPrice();
      });
    });

    // Fonction pour mettre à jour le total_price
    function updateTotalPrice() {
      // Obtenir les éléments d'entrée (champs de date)
      const startDateInput = document.getElementById("start_date");
      const endDateInput = document.getElementById("end_date");
      const totalPriceSpan = document.getElementById("total-price");

      // Récupérer les valeurs des champs de date
      const startDate = new Date(startDateInput.value);
      const endDate = new Date(endDateInput.value);

      // Calculer le nombre de jours de location
      const rentalDays = Math.max(0, (endDate - startDate) / (24 * 60 * 60 * 1000));

      // Supposons que bot.price_per_day est le prix par jour du bot
      const pricePerDay = <%= @bots.first.price_per_day %>; // Supposons que tous les bots ont le même prix par jour

      // Calculer le total_price
      const totalPrice = rentalDays * pricePerDay;

      // Mettre à jour le texte dans la balise <span>
      totalPriceSpan.innerText = <%= number_to_currency(totalPrice) %>;
    }

    // Appeler la fonction pour initialiser le total_price
    updateTotalPrice();
  });
</script>
