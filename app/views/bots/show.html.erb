<div class="page-header">
  <h1 class="merci">Merci pour votre choix</h1>
  <p>Vous avez choisi : <span><%= @bot.name.capitalize %></span></p>
</div>

<div class="container">
  <div class="card">
    <div class="card-header">
      <h2>Réservez votre expérience IA</h2>
    </div>

    <%= form_with(model: Rental.new, url: rentals_path, local: true, id: 'rental-form', class: 'rental-form') do |form| %>
      <%= form.hidden_field :bot_id, value: @bot.id %>

      <div class="form-group">
        <%= form.label :start_date, "Date de début" %>
        <%= form.date_field :start_date, id: 'start_date', class: 'form-control' %>
      </div>

      <div class="form-group">
        <%= form.label :end_date, "Date de fin" %>
        <%= form.date_field :end_date, id: 'end_date', class: 'form-control' %>
      </div>

      <%= form.submit "Réserver ce Bot", class: "submit-button" %>
    <% end %>
  </div>

  <div class="total" data-price-per-day="<%= @bot.price_per_day %>">
  <div class="price-card">
    <h2>Prix par jour</h2>
    <div class="price-per-day" id="price_per_day">
      <%= number_to_currency(@bot.price_per_day) %>
    </div>
  </div>
  </div>

  <div class="price-card">
    <h2>Coût total</h2>
    <div class="total-price" id="total-price">
      <%= number_to_currency(0) %>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const startDateInput = document.getElementById("start_date");
  const endDateInput = document.getElementById("end_date");
  const totalPriceSpan = document.getElementById("total-price");

  // Récupérer pricePerDay à partir d'un attribut de données
  const pricePerDay = parseFloat(document.getElementById("price_per_day").getAttribute("data-price-per-day"));

  function updateTotalPrice() {
    const startDate = new Date(startDateInput.value);
    const endDate = new Date(endDateInput.value);
    const rentalDays = Math.max(0, (endDate - startDate) / (24 * 60 * 60 * 1000));

    // Calculer le coût total
    const totalPrice = rentalDays * pricePerDay;

    // Mettre à jour l'affichage du coût total
    totalPriceSpan.innerText = '<%= number_to_currency(totalPrice) %>';
  }

  // Ajouter un addEventListener sur le changement de valeur des champs de date
  document.querySelectorAll(".form-control").forEach(function(input) {
    input.addEventListener("change", updateTotalPrice);
  });

  // Appeler la fonction pour initialiser le coût total
  updateTotalPrice();
});
